<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Matthew Derek Rall ‚Äî Game Developer</title>
    <meta name="description" content="Game developer & programmer crafting systems, tools, and playable prototypes. Dark-mode first, purple-accented portfolio." />
    <meta name="robots" content="index,follow" />
    <meta name="theme-color" content="#9D00FF" />

    <!-- Icons / Manifest -->
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/images/logo/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/images/logo/favicon-32x32.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/logo/favicon-32x32.png" />
    <link rel="manifest" href="/site.webmanifest" />

    <!-- Fonts (optional if already global) -->
    <link rel="preload" href="/assets/fonts/geist/Geist-VariableFont_wght.ttf" as="font" type="font/ttf" crossorigin />

    <!-- Core styles -->
    <link rel="stylesheet" href="/assets/css/global-style.css">
    <link rel="stylesheet" href="/assets/css/style.css">
    <!-- any other page CSS after this... -->
    <script defer src="/assets/js/apply-global-tokens.js"></script>
    <!-- Reuse project card visuals -->
    <link rel="stylesheet" href="/assets/css/projects-style.css" />
    <!-- Page-specific styles -->
    <link rel="stylesheet" href="/assets/css/index-style.css" />
</head>
<body>
<a href="#main" class="skip-link">Skip to main content</a>

<!-- Reusable Header Include -->
<div data-include="/assets/reusables/header.html"></div>

<!-- CMS Toolbar (visible only to authenticated admins) -->
<div id="cms-toolbar" class="cms-toolbar" style="display: none;">
    <div class="cms-toolbar__content">
        <div class="cms-toolbar__actions">
            <button onclick="window.cms?.savePage()" class="btn btn--primary btn--sm">üíæ Save Changes</button>
            <button onclick="window.cms?.resetPage()" class="btn btn--subtle btn--sm">üîÑ Reset</button>
            <button onclick="window.cms?.showGitHubSettings()" class="btn btn--subtle btn--sm">‚öôÔ∏è GitHub</button>
        </div>
    </div>
</div>

<!-- CMS Toggle Button (visible only to authenticated admins) -->
<button class="cms-toggle" onclick="window.cms?.toggleCMSMode()" title="Toggle Edit Mode" style="display: none;">‚úèÔ∏è</button>

<main id="main" role="main">
    <!-- HERO -->
    <section class="home-hero section">
        <div class="container">
            <div class="home-hero__content">
                <p class="eyebrow editable" contenteditable="false" data-field="home-eyebrow">Game Developer & Programmer</p>
                <h1 class="home-hero__title editable" contenteditable="false" data-field="home-hero-title">
                    Building systems, tools, and worlds you can play.
                </h1>
                <p class="home-hero__subtitle editable" contenteditable="false" data-field="home-hero-subtitle">
                    I prototype mechanics, write performant code, and ship dark-mode experiences with a purple pulse.
                </p>

                <div class="home-hero__actions">
                    <a href="/projects.html" class="btn btn--primary">View Projects</a>
                    <a href="/contact.html" class="btn btn--subtle">Contact</a>
                    <a href="/showreel.html" class="btn btn--subtle">Showreel</a>
                </div>
            </div>
        </div>
        <div class="home-hero__bg" aria-hidden="true"></div>
    </section>

    <!-- QUICK HIGHLIGHTS -->
    <section class="home-highlights section">
        <div class="container">
            <div class="highlight-grid">
                <article class="highlight-card">
                    <h3 class="highlight-title">Gameplay Prototypes</h3>
                    <p class="highlight-desc">Rapid iteration on mechanics and feel‚Äîtight loops, crisp inputs, juicy feedback.</p>
                </article>
                <article class="highlight-card">
                    <h3 class="highlight-title">Tools & Pipelines</h3>
                    <p class="highlight-desc">Small tools that save big time: build scripts, data pipelines, editor extensions.</p>
                </article>
                <article class="highlight-card">
                    <h3 class="highlight-title">Shaders & VFX</h3>
                    <p class="highlight-desc">Stylized visuals and performant effects that read cleanly in motion.</p>
                </article>
            </div>
        </div>
    </section>

    <!-- FEATURED PROJECTS (from /assets/data/projects.json) -->
    <section class="section home-projects">
        <div class="container">
            <header class="section-header">
                <h2 class="section-title editable" contenteditable="false" data-field="home-projects-title">Featured Projects</h2>
                <p class="section-subtitle editable" contenteditable="false" data-field="home-projects-subtitle">
                    A few picks from recent work. See the full list on the projects page.
                </p>
            </header>

            <div id="home-projects-grid" class="projects-grid" aria-live="polite"></div>

            <div class="section-cta">
                <a href="/projects.html" class="btn btn--subtle">Browse all projects ‚Üí</a>
            </div>
        </div>
    </section>

    <!-- FEATURED WEBSITES (from /assets/data/websites.json) -->
    <section class="section home-websites">
        <div class="container">
            <header class="section-header">
                <h2 class="section-title editable" contenteditable="false" data-field="home-websites-title">Recent Website Builds</h2>
                <p class="section-subtitle editable" contenteditable="false" data-field="home-websites-subtitle">
                    Production-ready, dark-mode-first sites for teams and creators.
                </p>
            </header>

            <div id="home-websites-grid" class="projects-grid" aria-live="polite"></div>

            <div class="section-cta">
                <a href="/websites-made.html" class="btn btn--subtle">See more websites ‚Üí</a>
            </div>
        </div>
    </section>

    <!-- SHOWREEL CALLOUT -->
    <section class="section home-showreel">
        <div class="container">
            <div class="showreel-card">
                <div class="showreel-copy">
                    <h2 class="section-title editable" contenteditable="false" data-field="home-showreel-title">Showreel</h2>
                    <p class="section-subtitle editable" contenteditable="false" data-field="home-showreel-subtitle">
                        A quick cut of gameplay, tools, and visuals in motion.
                    </p>
                    <a href="/showreel.html" class="btn btn--primary">Watch Showreel</a>
                </div>
                <a class="showreel-thumb" href="/showreel.html" aria-label="Open showreel">
                    <img src="/assets/images/showreel-poster.jpg" alt="" loading="lazy" decoding="async" />
                </a>
            </div>
        </div>
    </section>

    <!-- CONTACT CALLOUT -->
    <section class="section home-contact">
        <div class="container">
            <div class="contact-banner">
                <div class="contact-copy">
                    <h2 class="section-title editable" contenteditable="false" data-field="home-contact-title">Let‚Äôs build something</h2>
                    <p class="section-subtitle editable" contenteditable="false" data-field="home-contact-subtitle">
                        Got a prototype to ship, a system to optimize, or a site to launch?
                    </p>
                </div>
                <a href="/contact.html" class="btn btn--primary">Get in touch</a>
            </div>
        </div>
    </section>
</main>

<!-- Reusable Footer Include -->
<div data-include="/assets/reusables/footer.html"></div>

<!-- Core JS -->
<script src="/assets/js/includes.js"></script>
<script src="/assets/js/cms.js"></script>
<script src="/assets/js/header.js"></script>
<script src="/assets/js/footer.js"></script>

<!-- Home loaders: Featured Projects + Websites -->
<script>
    (function () {
        // Reuse project-card visuals from projects-style.css
        function createCard({ href, title, description, thumbnail }, external = false) {
            const a = document.createElement('a');
            a.className = 'project-card';
            a.href = href;
            if (external) { a.target = '_blank'; a.rel = 'noopener'; }
            a.setAttribute('aria-label', `Open ${title}`);

            const fig = document.createElement('figure');
            fig.className = 'project-thumb';
            const img = document.createElement('img');
            img.src = thumbnail;
            img.alt = `Thumbnail for ${title}`;
            img.loading = 'lazy';
            img.decoding = 'async';
            fig.appendChild(img);

            const meta = document.createElement('div');
            meta.className = 'project-meta';
            const h3 = document.createElement('h3');
            h3.className = 'project-title';
            h3.textContent = title;
            const p = document.createElement('p');
            p.className = 'project-desc';
            p.textContent = description;
            meta.appendChild(h3);
            meta.appendChild(p);

            a.appendChild(fig);
            a.appendChild(meta);
            return a;
        }

        async function loadFeaturedProjects(limit = 6) {
            const root = document.getElementById('home-projects-grid');
            if (!root) return;
            try {
                root.innerHTML = '<p style="text-align:center; opacity:.7;">Loading‚Ä¶</p>';
                const res = await fetch('/assets/data/projects.json', { cache: 'no-store' });
                if (!res.ok) throw new Error('Failed to load projects.json');
                const items = await res.json();

                root.innerHTML = '';
                (items || []).slice(0, limit).forEach(prj => {
                    root.appendChild(createCard({
                        href: prj.href,
                        title: prj.title,
                        description: prj.description || 'Project details and images.',
                        thumbnail: prj.thumbnail
                    }));
                });

                if (!items || items.length === 0) {
                    root.innerHTML = '<div class="projects-error" style="text-align:center; opacity:.8;">No projects yet.</div>';
                }
            } catch (e) {
                console.error(e);
                root.innerHTML = '<div class="projects-error" style="text-align:center; opacity:.8;">Could not load projects.</div>';
            }
        }

        async function loadFeaturedWebsites(limit = 4) {
            const root = document.getElementById('home-websites-grid');
            if (!root) return;
            try {
                root.innerHTML = '<p style="text-align:center; opacity:.7;">Loading‚Ä¶</p>';
                const res = await fetch('/assets/data/websites.json', { cache: 'no-store' });
                if (!res.ok) throw new Error('Failed to load websites.json');
                const items = await res.json();

                root.innerHTML = '';
                (items || []).slice(0, limit).forEach(site => {
                    root.appendChild(createCard({
                        href: site.url,
                        title: site.title,
                        description: site.shortDesc || (site.tags ? site.tags.join(', ') : 'Website build'),
                        thumbnail: site.thumbnail
                    }, /* external */ true));
                });

                if (!items || items.length === 0) {
                    root.innerHTML = '<div class="projects-error" style="text-align:center; opacity:.8;">No websites yet.</div>';
                }
            } catch (e) {
                console.error(e);
                root.innerHTML = '<div class="projects-error" style="text-align:center; opacity:.8;">Could not load websites.</div>';
            }
        }

        // Run after includes so header/footer are in place
        document.addEventListener('includesLoaded', () => {
            loadFeaturedProjects(6);
            loadFeaturedWebsites(4);
        });
    })();
</script>

<noscript>
    <style>#home-projects-grid,#home-websites-grid{display:none!important}</style>
    <div class="container" style="margin:1rem auto;">
        <div class="alert alert--error" role="alert">JavaScript is required to load featured items.</div>
    </div>
</noscript>
</body>
</html>
