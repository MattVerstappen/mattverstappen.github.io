<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>About â€” Matthew Derek Rall</title>
    <meta name="description" content="About Matthew Derek Rall â€” game developer and programmer. Skills, background, and downloadable CV."/>
    <meta name="robots" content="index,follow"/>
    <meta name="theme-color" content="#9D00FF"/>

    <!-- Icons / Manifest -->
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/images/logo/favicon-32x32.png"/>
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/images/logo/favicon-32x32.png"/>
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/logo/favicon-32x32.png"/>
    <link rel="manifest" href="/site.webmanifest"/>

    <!-- Fonts (optional if globally loaded) -->
    <link rel="preload" href="/assets/fonts/geist/Geist-VariableFont_wght.ttf" as="font" type="font/ttf" crossorigin/>

    <!-- Styles -->
    <link rel="stylesheet" href="/assets/css/global-style.css">
    <link rel="stylesheet" href="/assets/css/style.css">
    <link rel="stylesheet" href="/assets/css/about-style.css"/>

    <script defer src="/assets/js/apply-global-tokens.js"></script>
</head>
<body>
<a href="#main" class="skip-link">Skip to main content</a>

<!-- Reusable Header -->
<div data-include="/assets/reusables/header.html"></div>

<main id="main" role="main">
    <section class="about-section">
        <div class="container">
            <h1 id="about-title" class="page-title">About Me</h1>
            <p id="about-subtitle" class="page-intro">Game Developer & Programmer</p>

            <!-- Grid layout controlled by CSS grid-template-areas -->
            <div class="about-grid">
                <!-- Row 1 (left): Profile Photo -->
                <figure class="about-card about-photo-card">
                    <img
                            id="about-photo"
                            src="/assets/images/about-me-images-and-cv/profile-picture.jpg"
                            alt="Profile photo"
                            class="profile-photo"
                            loading="lazy"
                            decoding="async"
                    />
                    <figcaption class="visually-hidden">Profile photo</figcaption>
                </figure>

                <!-- Row 1 (right): Quick Info -->
                <section class="about-card card--info">
                    <h2 class="card-title">Quick Info</h2>
                    <div id="info-grid" class="info-grid">
                        <!-- Populated from about-me.json -->
                    </div>
                </section>

                <!-- Row 2 (left): Skills -->
                <section class="about-card card--skills">
                    <h2 class="card-title">Skills</h2>
                    <ul id="skills-list" class="skills-list">
                        <!-- Populated from about-me.json -->
                    </ul>
                </section>

                <!-- Row 2 (right): About Me -->
                <section class="about-card card--about">
                    <h2 class="card-title">About Me</h2>
                    <div id="about-description" class="about-description">
                        <!-- Populated from about-me.json (paragraphs) -->
                    </div>
                </section>

                <!-- Row 3: Resume (centered, full width) -->
                <section class="about-card card--cv">
                    <h2 class="card-title">Resume</h2>

                    <div class="cv-actions">
                        <a
                                id="cv-link"
                                href="/assets/images/about-me-images-and-cv/cv.pdf"
                                class="cv-download"
                                download="Matthew_Derek_Rall_CV.pdf"
                                role="button"
                                aria-label="Download Matthew Derek Rallâ€™s CV as PDF"
                        >
                            ðŸ“„ Download CV (PDF)
                        </a>

                        <a
                                href="/cv.html"
                                class="cv-view"
                                role="button"
                                aria-label="View Matthew Derek Rallâ€™s CV as a web page"
                        >
                            ðŸ”Ž View CV Online
                        </a>
                    </div>
                </section>
            </div>
        </div>
    </section>
</main>

<!-- Reusable Footer -->
<div data-include="/assets/reusables/footer.html"></div>

<!-- Core JS -->
<script src="/assets/js/includes.js"></script>
<script src="/assets/js/cms.js"></script>
<script src="/assets/js/header.js"></script>
<script src="/assets/js/footer.js"></script>

<!-- About page JSON loader -->
<script>
    (function () {
        const JSON_PATH = '/assets/data/about-me.json';

        const $ = (id) => document.getElementById(id);

        function telHref(raw) {
            // strip spaces, parentheses, hyphens for tel: link
            return 'tel:' + (raw || '').replace(/[()\s-]/g, '');
        }

        function renderQuickInfo(items = []) {
            const root = $('info-grid');
            if (!root) return;

            root.innerHTML = '';
            items.forEach(({ label, value, href }) => {
                if (!label || !value) return;

                const item = document.createElement('div');
                item.className = 'info-item';

                const lab = document.createElement('span');
                lab.className = 'info-label';
                lab.textContent = label;

                let valEl;
                if (href) {
                    valEl = document.createElement('a');
                    valEl.href = href;
                    valEl.className = 'info-value info-link';
                    valEl.textContent = value;
                } else {
                    valEl = document.createElement('span');
                    valEl.className = 'info-value';
                    valEl.textContent = value;
                }

                item.appendChild(lab);
                item.appendChild(valEl);
                root.appendChild(item);
            });
        }

        function renderSkills(skills = []) {
            const ul = $('skills-list');
            if (!ul) return;
            ul.innerHTML = '';
            skills.forEach((s) => {
                const li = document.createElement('li');
                li.className = 'skill-chip';
                li.textContent = s;
                ul.appendChild(li);
            });
        }

        function renderAbout(paragraphs = []) {
            const box = $('about-description');
            if (!box) return;
            box.innerHTML = '';
            paragraphs.forEach((text) => {
                const p = document.createElement('p');
                p.textContent = text;
                box.appendChild(p);
            });
        }

        async function init() {
            try {
                const res = await fetch(JSON_PATH, { cache: 'no-store' });
                if (!res.ok) throw new Error('Failed to load about-me.json');
                const data = await res.json();

                // Title / subtitle
                if (data.title) $('about-title').textContent = data.title;
                if (data.subtitle) $('about-subtitle').textContent = data.subtitle;

                // Profile photo + CV
                if (data.profilePhoto) {
                    const img = $('about-photo');
                    img.src = data.profilePhoto;
                    img.alt = (data.fullName || 'Profile') + ' â€” profile photo';
                }
                if (data.cvFile) {
                    const cv = $('cv-link');
                    cv.href = data.cvFile;
                }

                // Quick info
                const quick = [];
                if (data.fullName) quick.push({ label: 'Full Name', value: data.fullName });
                if (data.email) quick.push({ label: 'Email', value: data.email, href: 'mailto:' + data.email });
                if (data.phone) quick.push({ label: 'Phone', value: data.phone, href: telHref(data.phone) });
                if (data.location) quick.push({ label: 'Location', value: data.location });
                if (data.role) quick.push({ label: 'Role', value: data.role });
                renderQuickInfo(quick);

                // Skills
                if (Array.isArray(data.skills)) renderSkills(data.skills);

                // About paragraphs
                if (Array.isArray(data.about)) renderAbout(data.about);

            } catch (e) {
                console.error('About page data load error:', e);
                // Minimal graceful fallback (page already has default placeholders)
            }
        }

        // Run after includes so header/footer are in place
        document.addEventListener('includesLoaded', init);
        if (document.readyState !== 'loading') {
            // In case includes are already done
            setTimeout(init, 0);
        }
    })();
</script>
</body>
</html>
